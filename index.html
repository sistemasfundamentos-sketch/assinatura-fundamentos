<!DOCTYPE html><!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gerador de Assinatura - Baixar PNG</title>

<!-- Fonte Arimo -->
<link href="https://fonts.googleapis.com/css2?family=Arimo:wght@400;700&display=swap" rel="stylesheet">

<style>
  body { font-family: "Arimo", Arial, sans-serif; background:#f4f4f4; margin:0; padding:20px; color:#0a325c; }
  .wrap { max-width:1200px; margin:0 auto; }
  .form { display:flex; gap:20px; flex-wrap:wrap; align-items:flex-start; }
  .col { flex:1 1 320px; min-width:280px; background:#fff; padding:14px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
  label { display:block; font-weight:600; font-size:13px; margin-bottom:6px; color:#223; }
  input[type=text] { width:100%; padding:8px 10px; font-size:14px; border:1px solid #d0d7df; border-radius:6px; box-sizing:border-box; }
  button { background:#0a325c; color:white; border:0; padding:10px 14px; border-radius:6px; cursor:pointer; font-weight:600; }
  .preview { margin-top:18px; background:#fff; padding:10px; border-radius:8px; text-align:center; }
  /* IMPORTANT: do NOT distort preview - keep aspect ratio */
  #canvasPreview { width:100%; height:auto; display:block; }
  .small { font-size:12px; color:#666; margin-top:8px; }
</style>
</head>
<body>
<div class="wrap">
  <h1>Gerador de Assinatura</h1>

  <div class="form">
    <div class="col">
      <label>Nome</label>
      <input id="nome" type="text" value="Renan de Moura">

      <label style="margin-top:10px;">Cargo</label>
      <input id="cargo" type="text" value="Analista de TI">

      <label style="margin-top:10px;">Telefone</label>
      <input id="tel" type="text" value="+55 (12) 99795-6511">

      <label style="margin-top:10px;">E-mail</label>
      <input id="email" type="text" value="renan.moura@fundamentos.com.br">

      <div style="margin-top:12px;">
        <button id="btnGen" type="button">Baixar</button>
        <div class="small">Se estiver hospedando no GitHub, altere <code>bg.src</code> para o raw URL do repositório.</div>
      </div>
    </div>

    <div class="col">
      <div class="preview">
        <strong>Pré-visualização</strong>
        <div style="margin-top:10px;">
          <!-- canvas internal size must match template -->
          <canvas id="canvasPreview" width="1875" height="938"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ============ CONFIG ============
const CANVAS_W = 1875;
const CANVAS_H = 938;

const POS = {
  name:  { x: 965, y: 230 },
  role:  { x: 965, y: 305 },
  phone: { x: 1020, y: 403 },
  email: { x: 1020, y: 472 }
};

// force Arimo in canvas (via FontFace) and wait
async function loadArimo() {
  try {
    const arimo = new FontFace("Arimo", "url(https://fonts.gstatic.com/s/arimo/v28/P5sMzZCDf9_T_3cV7q6F.woff2)");
    await arimo.load();
    document.fonts.add(arimo);
  } catch (e) {
    console.warn('Falha ao carregar Arimo via FontFace - fallback para link CSS.');
  }
}
loadArimo();

// canvas & ctx
const canvas = document.getElementById('canvasPreview');
canvas.width = CANVAS_W;
canvas.height = CANVAS_H;
const ctx = canvas.getContext('2d');
ctx.textBaseline = 'top';

// LOAD BG IMAGE
const bg = new Image();
// 1) if running locally (same dir), use relative path:
bg.src = 'template-canva.png';
// 2) if you're hosting in GitHub Pages, replace above with the RAW URL like:
// bg.src = 'https://raw.githubusercontent.com/sistemasfundamentos-sketch/assinatura-fundamentos/main/template-canva.png';

let bgLoaded = false;
bg.onload = () => { bgLoaded = true; renderPreview(); };
bg.onerror = (e) => { console.error('Erro ao carregar template-canva.png', e); };

// Helper: draw using internal coords while accounting for displayed size (scale)
function drawOnCtx(drawFn) {
  // get displayed size of canvas (CSS pixels)
  const rect = canvas.getBoundingClientRect();
  const scaleX = rect.width / CANVAS_W;
  const scaleY = rect.height / CANVAS_H;
  // use uniform scale if you want to preserve aspect ratio (usually scaleX == scaleY)
  // set transform so drawing uses internal coordinates (0..CANVAS_W, 0..CANVAS_H)
  ctx.save();
  ctx.setTransform(scaleX, 0, 0, scaleY, 0, 0);
  // call the drawing function which uses internal coordinates
  drawFn(ctx);
  ctx.restore();
}

// Actual drawing logic using internal (native) coordinates
function drawInternal(c) {
  // clear internal
  c.clearRect(0, 0, CANVAS_W, CANVAS_H);
  // white background (optional)
  c.fillStyle = "#ffffff";
  c.fillRect(0, 0, CANVAS_W, CANVAS_H);

  if (bgLoaded) {
    c.drawImage(bg, 0, 0, CANVAS_W, CANVAS_H);
  }

  const nome = document.getElementById('nome').value || '';
  const cargo = document.getElementById('cargo').value || '';
  const tel = document.getElementById('tel').value || '';
  const email = document.getElementById('email').value || '';

  // NOME
  c.fillStyle = "#282935";
  c.font = "700 58px Arimo";
  c.fillText(nome, POS.name.x, POS.name.y);

  // CARGO
  c.fillStyle = "#282935";
  c.font = "400 40px Arimo";
  c.fillText(cargo, POS.role.x, POS.role.y);

  // TELEFONE
  c.fillStyle = "#242424";
  c.font = "400 40px Arimo";
  c.fillText(tel, POS.phone.x, POS.phone.y);

  // EMAIL
  c.fillStyle = "#242424";
  c.font = "400 40px Arimo";
  c.fillText(email, POS.email.x, POS.email.y);
}

// Render preview (draw scaled so preview == export)
async function renderPreview() {
  await document.fonts.ready; // ensure font loaded
  drawOnCtx(drawInternal);
}

// update on input
['nome','cargo','tel','email'].forEach(id => {
  document.getElementById(id).addEventListener('input', renderPreview);
});

// when bg loads, initial render
if (bg.complete) { bgLoaded = true; renderPreview(); }

// ============ EXPORT / DOWNLOAD ============
document.getElementById('btnGen').addEventListener('click', async function (evt) {
  if (evt && evt.preventDefault) evt.preventDefault();
  await document.fonts.ready;

  if (!bgLoaded) {
    alert('Template não carregado ainda. Aguarde e tente novamente.');
    return;
  }

  // create out canvas at native size (no CSS scaling here)
  const outCanvas = document.createElement('canvas');
  outCanvas.width = CANVAS_W;
  outCanvas.height = CANVAS_H;
  const out = outCanvas.getContext('2d');

  // draw exactly the same internal content
  drawInternal(out);

  // toBlob + download
  if (outCanvas.toBlob) {
    outCanvas.toBlob(function(blob) {
      if (!blob) { alert('Erro ao gerar imagem.'); return; }
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.style.display = 'none';
      a.href = url;
      a.download = 'assinatura_final.png';
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ document.body.removeChild(a); URL.revokeObjectURL(url); }, 200);
    }, 'image/png', 1.0);
  } else {
    // fallback: dataURL
    try {
      const dataURL = outCanvas.toDataURL('image/png');
      const w = window.open();
      if (w) { w.document.write('<img src="'+dataURL+'">'); w.document.close(); }
    } catch (err) {
      alert('Erro ao exportar imagem. Verifique console.');
      console.error(err);
    }
  }
});
</script>
</body>
</html>


